
@{
    ViewBag.Title = "编辑单位内容";
}

<link rel="stylesheet" href="~/css/jquery-ui-timepicker-addon.css" />
<link rel="stylesheet" href="~/js/ztree/zTreeStyle/zTreeStyle.css" type="text/css">
<link rel="stylesheet" href="~/css/icheck/minimal/minimal.css" />
<link rel="stylesheet" href="~/css/select/easydropdown.metro.css" />
<link href="~/css/sweetalert2.css" rel="stylesheet" />
<link rel="stylesheet" href="~/css/style.css" />
<link href="~/css/loading.css" rel="stylesheet" />
<style>
    * {
        margin: 0;
    }

    ul li {
        list-style: none;
    }

    .block-left {
        padding-right: 0;
    }

    .meet-form.meet-form9.meet-form3 .form-tr:nth-child(1) {
        background: #eaf6fd;
    }

    .canvas {
        width: 100%;
        height: 100%;
        position: fixed;
        top: 0;
        left: 0;
        background: rgba(198,200,177,.6);
        z-index: 9999;
        display: none;
    }

        .canvas .canvas_content {
            width: 450px;
            height: 300px;
            background: #e9f6fe;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            margin: auto;
            border: 1px solid #008cd6;
        }

        .canvas .canvas_close {
            display: inline-block;
            width: 35px;
            height: 35px;
            font-size: 30px;
            color: #008cd6;
            margin-left: 415px;
            text-align: center;
            cursor: pointer;
        }

    .canvas_content_text {
        width: 100%;
        height: 50%;
        margin-top: 10px;
    }

        .canvas_content_text ul li {
            padding: 5px 10px;
            margin-left: 20px;
        }

            .canvas_content_text ul li input[type="text"] {
                -web-kit-appearance: none;
                -moz-appearance: none;
                width: 270px;
                height: 25px;
                border: 1px solid #c8cccf;
                border-radius: 5px;
                color: #6a6f77;
                outline: 0;
                padding-left: 5px;
            }

            .canvas_content_text ul li .upload {
                position: relative;
                display: inline-block;
                text-align: center;
                color: #ffffff;
                width: 70px;
                height: 30px;
                line-height: 30px;
                background-color: #008bd6;
                border-radius: 3px;
            }

                .canvas_content_text ul li .upload input[type="text"] {
                    opacity: 0;
                    position: absolute;
                    left: 0;
                }

    .canvas_btn {
        text-align: center;
        padding-top: 50px;
    }

    .canvas-fj {
        padding-left: 5px;
        display: inline-block;
        font-size: 14px;
        color: #bfbdba;
    }

    i.img-aui-img-name-p {
        display: block;
    }

    .img-box {
        overflow: hidden;
        margin-left: 130px;
    }

    .aui-photo {
        overflow: hidden;
    }

    .img-box li {
        float: left;
        width: 25%;
        position: relative;
    }

        .img-box li div {
            padding: 0 2%;
            display: block;
            height: 130px;
            line-height: 130px;
            text-align: center;
            overflow: hidden;
        }

            .img-box li div img {
                margin: 0 auto;
                text-align: center;
                max-width: 100%;
                vertical-align: middle;
                max-height: 130px;
            }

        .img-box li p {
            text-align: center;
            font-size: 14px;
            padding: 0 10px;
            line-height: 20px;
            margin-top: 5px;
        }

        .img-box li .aui-close-up-img {
            position: absolute;
            top: -10px;
            right: -12px;
            display: none;
            z-index: 10;
            width: 20px;
            cursor: pointer;
        }

        .img-box li .aui-up-span {
            display: block;
            width: 100%;
            height: 100%;
            visibility: hidden;
            position: absolute;
            top: 0px;
            left: 0px;
            z-index: 9;
            background: rgba(0, 0, 0, .5);
            border: 1px solid #ddd;
        }

        .img-box li:hover .aui-close-up-img {
            display: block;
        }

        .img-box li:hover .aui-up-span {
            visibility: visible;
        }

        .img-box li .aui-close-up-img {
            top: 0;
            right: -1px;
        }

        .img-box li .aui-up-span {
            background: rgba(0, 0, 0, .3);
        }

    .aui-mask-content .aui-check-text span {
        width: 48%;
    }

    .fileInput, .allfileInput {
        background: transparent;
    }

    .upload-btn {
        border: 0px;
    }

    .dw {
        display: block;
        background: transparent;
        padding: 0px;
        width: 350px;
        float: left;
        margin-left: 0px;
        line-height: 14px;
        margin-top: 10px;
    }

        .dw > ul > li {
            margin-bottom: 3px;
        }

            .dw > ul > li > a {
                color: #008cd6;
                padding-left: 10px;
            }

    #tworkhistory > tr > td:last-child {
        display: none;
    }
</style>

<div class="left-nav">
    <div class="left-nav-con">
        <h1>劳务承分包企业</h1>
        <ul class="left-nav-list">
            <li><a href="/Companys" @ViewBag.InActive><i class="icon icon-eye"></i>名录内单位</a></li>
            <li><a href="/Companys/CompanysOut" @ViewBag.OutActive><i class="icon icon-hand"></i>名录外单位</a></li>
            <li><a href="/Companys/MyAudit"><i class="icon icon-edit"></i>我审核的</a></li>
            <li><a href="/Companys/MyRecommend"><i class="icon icon-user"></i>我提交的</a></li>
        </ul>
    </div>
</div>

<div class="main-con">
    <div class="main-wrap">
        <div class="main-top top-bottom">
            <span class="left-line"></span>
            <span class="page-title">修改企业信息</span>
        </div>
        <div class="wc-container app-dt">
            <div class="wc-nav">
            </div>
            <div class="block-left ">

                <table class="meet-form meet-form9 meet-form3">
                    <tbody>
                        <tr class="form-tr">
                            <td class="form-lable"><span class="red-word">*</span>企业名称：</td>
                            <td>
                                <input name="roomInfoName" type="text" value="@ViewBag.Name" id="companyName"
                                       class="has-clear-input input input3" autofocus />
                            </td>
                        </tr>
                        <tr class="form-tr">
                            <td class="form-lable">业务类型：</td>
                            <td>
                                <div class="form-item  sel-required">
                                    <select class="select radius-sel dropdown" name="iofnName"
                                            id="bType" value="@ViewBag.BusinessType"></select>

                                </div>
                            </td>
                        </tr>
                        <tr class="form-tr">
                            <td class="form-lable"><span class="red-word">*</span>推荐人：</td>
                            <td>
                                <input name="roomInfoName" type="text" value="@ViewBag.Referre" id="refererName"
                                       class="has-clear-input input input3 input4" />
                                <span class="td-cer">推荐书：</span>
                                <div class="upload-btn upload-btn2 upload-btn3">
                                    <form id='bfupform1' name='bfupform' method="post" target='frameFile' action="/Common/UploadReference" enctype="multipart/form-data" class="allfileInput allfileInput2" style="cursor: pointer;">
                                        <input type="file" name="fileInput1" id="allfileInput1" value=""style="opacity:0;">
                                        <input type="text" id="referPic" name="foreRef" width="20" value="" hidden />
                                    </form>
                                    <img src="/img/icon-add2.png" alt="" class="up up2">
                                    <div class="dw1" style="padding-left:50px;text-align:left">推荐书图片</div>
                                </div>
                            </td>
                        </tr>
                        <tr class="form-tr ">
                            <td class="form-lable"><span class="red-word">*</span>营业执照：</td>
                            <td>
                                <div class="upload-btn upload-btn2 upload-btn4">
                                    <form id='bfupform2' name='bfupform' method="post" target='frameFile' action="/Common/UploadFile" enctype="multipart/form-data" class="allfileInput allfileInput2" style="cursor: pointer;">
                                        <input type="file" name="fileInput" onchange="gen_base64(this, 'busiLicPic')" id="allfileInput2" value="" style="opacity:0;">
                                        <input id="busiLicPic" type="text" name="foreRef" hidden>
                                    </form>                                   
                                    <img src="/img/icon-add2.png" alt="" class="up up2">
                                    <div class="dw2" style="padding-left:50px;text-align:left">营业执照图片</div>
                                </div>
                                <span style="font-size: 14px;"> 统一社会信用代码号：</span>
                                <input name="youziz" id="socialCreditNo" type="text" value=""
                                       class="has-clear-input input input3 input4" required><span class="tips" id="zizhi"></span>
                                @*onBlur="checkpsd2()"*@
                            </td>
                        </tr>
                        <tr class="form-tr ">
                            <td class="form-lable"><span class="red-word">*</span>资质等级：</td>
                            <td>
                                <input name="roomInfoName" type="text" value="@ViewBag.QualificationLevel" id="qualificationLevel"
                                       class="has-clear-input input input5" />
                            </td>
                        </tr>
                        <tr class="form-tr tr-pic2">
                            <td class="form-lable"></td>
                            <td>
                                <div class="aui-form-input" id="addfile-up">
                                    <div class="aui-content-img-box aui-content-full">
                                        <div class="aui-photo aui-up-img">
                                            <section class="aui-file-up fl">
                                                <img src="~/img/up.png" class="add-img">
                                                @*<input type="file" name="file" id="file" class="file" value=""
                                                    accept="image/jpg,image/jpeg,image/png,image/bmp" multiple="">*@
                                            </section>
                                            <ul class="img-box" id="zzlist"></ul>
                                        </div>
                                    </div>
                                </div>
                                <!-- 添加资质弹框-->
                                <div class="canvas">
                                    <div class="canvas_content">
                                        <span class="canvas_close">×</span>
                                        <div class="canvas_content_text">
                                            <ul>
                                                <li>资质名称： <input type="text" id="input_zzmc" placeholder="资质名称" onblur="zzmc()" style=""><span id="zzmcmsg"></span></li>
                                                <li>证书编号： <input type="text" id="input_zsbh" placeholder="(粤)JZ安许可证[2017]020932" onblur="zsbh()"><span id="zsbhmsg"></span></li>
                                                <li>
                                                    <input type="file" name="fileInput" onchange="gen_base64(this, 'zzzsPic')" id="allfileInput3"><span id="zspicmsg"></span>
                                                    <div id="zzzsPic" style="display:none"></div>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="canvas_btn">
                                            <a href="#" class="meet-btn big-btn lightblue-btn" onclick="submitImg()">提交</a>
                                            <a href="#" class="meet-btn big-btn gray-btn" onclick="cancelImg()">返回</a>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr class="form-tr ">
                            <td class="form-lable"><span class="red-word">*</span>安全证书：</td>
                            <td>
                                <div class="upload-btn upload-btn2 upload-btn4">
                                    <form id='bfupform3' name='bfupform' method="post" target='frameFile' action="/Common/UploadFile" enctype="multipart/form-data" class="allfileInput allfileInput2" style="cursor: pointer;">
                                        <input type="file" name="fileInput" onchange="gen_base64(this, 'scPic')" id="allfileInput4" style="opacity:0;">
                                        <input id="scPic" type="text" name="foreRef" hidden>
                                    </form>
                                    <img src="/img/icon-add2.png" alt="" class="up up2">
                                    <div class="dw3" style="padding-left:50px;text-align:left">安全证书图片</div>
                                </div>
                                <span style="font-size: 14px;">证件编号：</span>
                                <input name="youbh" type="text" value="@ViewBag.SecurityCertificateNo" id="licenseNo"
                                       class="has-clear-input input input3 input4 "
                                       required><span class="tips" id="zjbh"></span>
                            </td>
                        </tr>
                        <tr class="form-tr">
                            <td class="form-lable"><span class="white-word">*</span>业务范围：</td>
                            <td>
                                <input name="roomInfoName" type="text" value="@ViewBag.BusinessScope" id="businessScope"
                                       class="has-clear-input input input3 input6" />
                                <span class="td-cer">注册资金： </span>
                                <input name="roomInfoName" type="text" id="registerMoney"
                                       value="@ViewBag.RegisteredCapital"
                                       class="has-clear-input input input3 input4" />万元
                            </td>
                        </tr>
                        <tr class="form-tr">
                            <td class="form-lable"><span class="red-word">*</span>法人代表：</td>
                            <td>
                                <input name="roomInfoName" type="text" value="@ViewBag.CorporateRepresentative" id="companyRepresentative"
                                       class="has-clear-input input input3 input4" />
                                <span class="td-cer">联系电话： </span><input name="roomInfoName" type="text"
                                                                         value="@ViewBag.RepPhone" id="repTelephone"
                                                                         class="has-clear-input input input3 input4" />
                                <span class="td-cer">身份证扫描：</span>
                                <div class="upload-btn upload-btn2 upload-btn3">
                                    <form id='bfupform4' name='bfupform' method="post" target='frameFile' action="/Common/UploadFile" enctype="multipart/form-data" class="allfileInput allfileInput2" style="cursor: pointer;">
                                        <input type="file" name="fileInput" onchange="gen_base64(this, 'repSFZ')"
                                               id="allfileInput5" style="opacity:0;">
                                        <input id="repSFZ" type="text" name="foreRef" hidden>
                                    </form>
                                    <img src="/img/icon-add2.png" alt="" class="up up2">
                                    <div class="dw4" style="padding-left:50px;text-align:left">身份证图片</div>
                                </div>

                            </td>
                        </tr>
                        <tr class="form-tr">
                            <td class="form-lable"><span class="red-word">*</span>现场负责人：</td>
                            <td>
                                <input name="roomInfoName" type="text" value="@ViewBag.Contact" id="contact"
                                       class="has-clear-input input input3 input4" />
                                <span class="td-cer">联系电话： </span><input name="roomInfoName" type="text"
                                                                         value="@ViewBag.ContactPhone" id="contactPhone"
                                                                         class="has-clear-input input input3 input4" />
                                <span class="td-cer">身份证扫描：</span>
                                <div class="upload-btn upload-btn2 upload-btn3">
                                    <form id='bfupform5' name='bfupform' method="post" target='frameFile' action="/Common/UploadFile" enctype="multipart/form-data" class="allfileInput allfileInput2" style="cursor: pointer;">
                                        <input type="file" name="fileInput" onchange="gen_base64(this, 'conSFZ')" id="allfileInput6" style="opacity:0;">
                                        <input id="conSFZ" type="text" name="foreRef" hidden>
                                    </form>
                                    <img src="/img/icon-add2.png" alt="" class="up up2">
                                    <div class="dw5" style="padding-left:50px;text-align:left">身份证图片</div>
                                </div>
                            </td>
                        </tr>
                        <tr class="form-tr">
                            <td class="form-lable"><span class="white-word">*</span>联系地址：</td>
                            <td>
                                <input name="roomInfoName" type="text" value="@ViewBag.ContactAddress" id="contactAddress"
                                       class="has-clear-input input input3" />
                            </td>
                        </tr>
                        <tr class="form-tr">
                            <td class="form-lable">施工内容：</td>
                            <td>
                                <textarea name="roomInfoName" type="text" id="construction"
                                          class="has-clear-input input input3" placeholder="输入推荐参与施工内容" onfocus="if (placeholder == '输入推荐参与施工内容') { placeholder = '' }" onblur=" if (value= ='' ) { placeholder='输入推荐参与施工内容' }">
                                    @ViewBag.ConstructionContent
                                    </textarea>
                                </td>
                            </tr>
                            <tr class="form-tr">
                                <td class="form-lable">备注：</td>
                                <td>
                                    <input name="roomInfoName" type="text" value="@ViewBag.Note" id="note"
                                           class="has-clear-input input input7" placeholder="请输入其他说明" onfocus="if (placeholder == '输入推荐参与施工内容') { placeholder = '' }" onblur=" if (value= ='' ) { placeholder='请输入其他说明' }">
                                </td>
                            </tr>
                            <tr class="form-tr detail-user-con gzyj">
                                <td colspan="2">
                                    <h3 class="yj-tit">工作业绩:</h3>
                                    <table style="width: 100%" class="table01">
                                        <thead class="wc-header gzyjthead">
                                            <tr>
                                                <td style="width:150px;padding:0 5px">承包项目</td>
                                                <td style="width:80px;padding:0 5px">合同金额</tdstyle="width:150px;padding:0>
                                                <td style="width:100px;padding:0 5px">开工日期</td>
                                                <td style="width:100px;padding:0 5px">竣工日期</td>
                                                <td style="width:50px;padding:0 5px">状态</td>
                                                <td style="width:80px;padding:0 5px">结算金额</td>
                                                <td style="width:100px;padding:0 5px">合同扫描件</td>
                                                <td style="width:80px;padding:0 5px">操作</td>
                                                <td style="display:none;width:80px;padding:0 5px">合同扫描件</td>

                                            </tr>
                                        </thead>
                                        <tbody id="tworkhistory">
                                            @Html.Raw(ViewBag.WorkHistory)
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- mask begin -->
                    <div class="aui-mask aui-works-mask">
                        <div class="aui-mask-content">
                            <p class="aui-delete-text">确定要删除你上传的资料？</p>
                            <p class="aui-check-text">
                                <span class="aui-delete aui-accept-ok">确定</span>
                                <span class="aui-accept-no">取消</span>
                            </p>
                        </div>
                    </div>
                    <!-- mask end -->
                    <div class="add-yej">
                        <h3>添加业绩</h3>
                        <div class="cb">
                            <label for="">项目名称：</label><input type="text" class="has-clear-input input input3" maxlength="30" name="roomInfoName" value="" id="projName" />
                            <label for="" style="width:100px;float:left">合同扫描件：</label>
                            <div class="upload-btn upload-btn2" style="top:0px;width: 40px;float:left;">
                                <form id='fupform' name='fupform' method="post" target='frameFile' action="/Common/UploadTestifyFile" enctype="multipart/form-data" class="allfileInput allfileInput2" style="cursor: pointer;">
                                    <input type='file' id='fileInfoName' name='fup' value="IamPic" style="opacity:0;" />
                                    <input type="text" id="fname" name="fname" width="20" value="4" style="display:none" />
                                </form>
                                <img src="/img/icon-add2.png" alt="" class="up up2">
                            </div>
                            <div class="dw"></div>
                        </div>
                        <div class="cb">
                            <label for="">合同金额：</label><input type="text" class="input8" id="contractAmount">&nbsp;万
                            <span>状态：</span><select class="select radius-sel dropdown"
                                                    name="iofnName" id="iofnName">
                                <option value="正常">正常</option>
                                <option value="延期">延期</option>
                            </select><span>开工时间：</span><input name="userTimeBegin" id="timeBegin"
                                                              class="date-input radius-sel Wdate"
                                                              type="text" value=""
                                                              placeholder="开工日期" onfocus="if (placeholder == '开工日期') { placeholder = '' }" onblur="if (value == '') { placeholder = '开工日期' }"
                                                              onclick="WdatePicker({dateFmt:'yyyy-MM-dd',minDate:'',maxDate:''})">
                            <span>竣工时间：</span><input name="userTimeBegin" id="timeEnd"
                                                     class="date-input radius-sel Wdate"
                                                     type="text" value="" placeholder="竣工日期" onfocus="if (placeholder == '竣工日期') { placeholder = '' }" onblur="if (value == '') { placeholder = '竣工日期' }"
                                                     onclick="WdatePicker({dateFmt:'yyyy-MM-dd',minDate:'',maxDate:''})">
                            <span>结算金额：</span><input type="text" class="input8" id="settleAmount">&nbsp;万元
                        </div>

                        <div class="btn-add">
                            <button class="" onclick="addworkHistory()">添加</button>
                        </div>
                    </div>

                    <div class="form-tr-btn">
                        <button type="submit" class="meet-btn big-btn lightblue-btn" onclick="saveCompany()">提交</button>@*js-submit*@
                        @*<button type="submit" class="meet-btn big-btn lightblue-btn js-submit">保存</button>*@
                        <button type="reset" class="meet-btn big-btn gray-btn" onclick="">取消</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="~/js/jquery-1.11.0.js"></script>
    <script type="text/javascript" src="~/js/My97DatePicker/WdatePicker.js"></script>
    <script src="~/js/sweetalert2.all.js"></script>
    <script type="text/javascript" src="~/js/validate/jquery.validate.min.js"></script>
    <script type="text/javascript" src="~/js/validate/messages_zh.min.js"></script>
    <script type='text/javascript' src='~/js/js.js'></script>
    <script src="~/Scripts/jquery-3.3.1.js"></script>
    <script src="~/Scripts/jquery-3.3.1.min.js" type="text/javascript"></script>
    <script src="~/Scripts/jquery.form.js"></script>
    <script type="text/javascript" src="~/js/js.js"></script>
    <script type="text/javascript" src="~/js/loading.js"></script>
    <script type="text/javascript" src="~/js/up.js"></script>
    <script type='text/javascript'>


        //业绩附件上传
    $("#fileInfoName").change(function () {
        var fileInfoName = $("#fileInfoName").val();
        if (fileInfoName == "") { //点击取消，取消事件的编写
            return;
        }
        $("#fupform").ajaxSubmit(function (res) {
          console.log(res);
          var fileName = res.split('|');
          $(".dw").html(fileName[1]);
          $("#fname").val(fileName[0]);
        });
    })


      //推荐书附件上传
    $("#allfileInput1").change(function () {
        var allfileInput1 = $("#allfileInput1").val();
        if (allfileInput1 == "") { //点击取消，取消事件的编写
            return;
        }
        $("#bfupform1").ajaxSubmit(function (res) {
            var fileName = res.split('|');
            $(".dw1").html(fileName[1]);
            $("#referPic").val(fileName[0]);
        });
    })


    //营业执照附件上传
    $("#allfileInput2").change(function () {
        var allfileInput2 = $("#allfileInput2").val();
        if (allfileInput2 == "") { //点击取消，取消事件的编写
            return;
        }
        $("#bfupform2").ajaxSubmit(function (res) {
            var fileName = res.split('|');
            $(".dw2").html(fileName[1]);
            $("#busiLicPic").val(fileName[0]);
        });
    })

    //安全证书附件上传
    $("#allfileInput4").change(function () {
        var allfileInput4 = $("#allfileInput4").val();
        if (allfileInput4 == "") { //点击取消，取消事件的编写
            return;
        }
        $("#bfupform3").ajaxSubmit(function (res) {
            var fileName = res.split('|');
            $(".dw3").html(fileName[1]);
            $("#scPic").val(fileName[0]);
        });
    })

    //法人身份证附件上传
    $("#allfileInput5").change(function () {
        var allfileInput5 = $("#allfileInput5").val();
        if (allfileInput5 == "") { //点击取消，取消事件的编写
            return;
        }
        $("#bfupform4").ajaxSubmit(function (res) {
            var fileName = res.split('|');
            $(".dw4").html(fileName[1]);
            $("#repSFZ").val(fileName[0]);
        });
    })


    //现场负责人身份证附件上传
    $("#allfileInput6").change(function () {
        var allfileInput6 = $("#allfileInput6").val();
        if (allfileInput6 == "") { //点击取消，取消事件的编写
            return;
        }
        $("#bfupform5").ajaxSubmit(function (res) {
            var fileName = res.split('|');
            $(".dw5").html(fileName[1]);
            $("#repSFZ").val(fileName[0]);
        });
    })


    function saveCompany() {
        var companyName = $("#companyName").val();
        var refererName = $("#refererName").val();
        var allfileInput1 = $("#allfileInput1").val();
        var allfileInput2 = $("#allfileInput2").val();
        var socialCreditNo = $("#socialCreditNo").val();
        var qualificationLevel = $("#qualificationLevel").val();
        var zzlist = $("#zzlist").html();
        var allfileInput4 = $("#allfileInput4").val();
        var licenseNo = $("#licenseNo").val();
        var companyRepresentative = $("#companyRepresentative").val();
        var repTelephone = $("#repTelephone").val();
        var allfileInput5 = $("#allfileInput5").val();
        var contact = $("#contact").val();
        var contactPhone = $("#contactPhone").val();
        var allfileInput6 = $("#allfileInput6").val();



        if (companyName == "") {
            document.getElementById("companyName").focus();
            swal({
                title: '企业名称不能为空！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }

            )
            return;
        } else if (refererName == "") {

            document.getElementById("refererName").focus();
            swal({
                title: '请填写推荐人！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (allfileInput1 == "") {
            document.getElementById("allfileInput1").focus();
            swal({
                title: '请上传推荐书！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (allfileInput2 == "") {

            document.getElementById("allfileInput2").focus();
            swal({
                title: '请上传营业执照！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        }
        else if (socialCreditNo == "") {
            document.getElementById("socialCreditNo").focus();
            swal({
                title: '请填写统一社会信用代码号！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (qualificationLevel == "") {
            document.getElementById("qualificationLevel").focus();
            swal({
                title: '请填写资质等级!!!！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (zzlist == "") {
            swal({
                title: '请上传企业资质！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (allfileInput4 == "") {
            document.getElementById("allfileInput4").focus();
            swal({
                title: '请上传安全证书！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (licenseNo == "") {

            document.getElementById("licenseNo").focus();
            swal({
                title: '请上传证件编号！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (companyRepresentative == "") {

            document.getElementById("companyRepresentative").focus();
            swal({
                title: '请填写法人代表！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (repTelephone == "") {
            document.getElementById("repTelephone").focus();
            swal({
                title: '请填写法人代表联系电话！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (allfileInput5 == "") {

            document.getElementById("allfileInput5").focus();
            swal({
                title: '请上传法人代表身份证扫描件！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (contact == "") {
            document.getElementById("contact").focus();
            swal({
                title: '请填写现场负责人！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (contactPhone == "") {

            document.getElementById("contactPhone").focus();
            swal({
                title: '请填写现场负责人联系电话！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        } else if (allfileInput6 == "") {

            document.getElementById("allfileInput6").focus();
            swal({
                title: '请上传现场负责人身份证扫描件！',
                text: '2秒后自动关闭。',
                timer: 2000
            }).then(
                function () { },
                // handling the promise rejection
                function (dismiss) {
                    if (dismiss === 'timer') {
                        console.log('I was closed by the timer');
                    }
                }
            )
            return;
        }

        var comName = $("#companyName").val()
        var bt = $("#bType").val()
        var refname = $("#refererName").val()
        var scno = $("#socialCreditNo").val()
        var ql = $("#qualificationLevel").val()
        var lno = $("#licenseNo").val()
        var bs = $("#businessScope").val()
        var rm = $("#registerMoney").val()
        var sr = $("#companyRepresentative").val()
        var rt = $("#repTelephone").val()
        var ct = $("#contact").val()
        var ctp = $("#contactPhone").val()
        var caddress = $("#contactAddress").val()
        var construct = $("#construction").val()
        var nn = $("#note").val()
        var refdoc = $("#referPic").val();
        var tdfilename = $("#tworkhistory tr td:last-child").html();

        var data = {
            cname: comName, btype: bt, rname: refname, scno: scno, qlevel: ql,
            lno: lno, bscope: bs, rmoney: rm, rep: sr, rtel: rt, refd: refdoc,
            contact: ct, cphone: ctp, caddress: caddress, construction: construct, note: nn, auditstatus: 1
        }
        // show
        $('body').loading({
            loadingWidth: 240,
            title: '请稍等!',
            name: 'test',
            discription: '正在创建公司',
            direction: 'column',
            type: 'origin',
            // originBg:'#71EA71',
            originDivWidth: 40,
            originDivHeight: 40,
            originWidth: 6,
            originHeight: 6,
            smallLoading: false,
            loadingMaskBg: 'rgba(0,0,0,0.2)'
        });
        $.post("/Companys/Create", data, function (res) {
            console.log(1)
            if (res == "1") {
                uploadWorkHistory();
            } else {
                //hide
                removeLoading('test');
                swal('公司创建失败')
            }
        })
    }
    function uploadPics() {
        var blpic = document.getElementById("busiLicPic").innerText
        var scPic = document.getElementById("scPic").innerText
        var rsfz = document.getElementById("repSFZ").innerText
        var ctsfz = document.getElementById("conSFZ").innerText
        var data = { picdata: blpic, name: "blpic" }
        $.post("/Companys/UploadPic", data, function (res) {
            data = { picdata: scPic, name: "scPic" }
            $.post("/Companys/UploadPic", data, function (res) {
                data = { picdata: rsfz, name: "rsfz" }
                $.post("/Companys/UploadPic", data, function (res) {
                    data = { picdata: ctsfz, name: "ctsfz" }
                    $.post("/Companys/UploadPic", data, function (res) {
                        uploadZZPics();
                    })
                })
            })
        })
    }
    function uploadWorkHistory() {
        var wh = $("#tworkhistory")
        var children = wh.children();
        //console.log(children)
        var data = "";
        for (var i = 0; i < children.length; i++) {
            var item = children[i].children[0].innerText + '|' + children[i].children[1].innerText + '|' +
                children[i].children[2].innerText + '|' +
                children[i].children[3].innerText + '|' +
                children[i].children[4].innerText + '|' +
                children[i].children[5].innerText + '|' +
                children[i].children[6].innerText + '|' +
                children[i].children[8].innerText
            data += item + "^"
        }

        $.post("/Companys/UploadWorkHistory", { workhistory: data }, function (res) {
            uploadPics();
        });
    }
    function uploadZZPics() {
        var lis = $('#zzlist').children();
        for (var i = 0; i < lis.length; i++) {
            var cd = lis[i].childNodes;
            var b64 = cd[0].childNodes[2].src;
            var zzname = cd[1].innerText;
            var zzcode = cd[3].innerText;
            var data = { picData: b64, name: zzname, code: zzcode };
            $.post("/Companys/UploadZiZhi", data, function () {
                removeLoading('test');
                swal('公司创建成功').then(function () {
                     window.location.href = "/Companys/MyRecommend";
                });

            });
        }
    }
    $(function () {
        $.post("/Common/GetCompanyType", {}, function (data) {
            var obj = JSON.parse(data);
            var btype = $("#bType");
            for (var i = 0; i < obj.length; i++) {
                var o = obj[i]
                btype.append("<option value='" + o.id + "'>" + o.name + "</option>")
            }
        });
    });
    function gen_base64(obj, savePos) {
        var file = obj.files[0];
        var compress = false;
        var quality = 0.0;
        // 大于1.5M就压缩
        if (file.size / 1024 > 1500) {
            compress = true;
            quality = 1024 * 1500 / file.size;
            console.log(quality)
        }
        r = new FileReader();  //本地预览
        r.onload = function () {
            var sp = document.getElementById(savePos);
            if (compress) {
                canvasDataURL(r.result, file, quality, sp);
            }
            else
                sp.innerText = r.result;
        }
        r.readAsDataURL(file);
    }
    // 压缩图片
    function canvasDataURL(path, obj, quality, sp) {
        var img = new Image();
        img.src = path;
        img.onload = function () {
            var that = this;
            // 默认按比例压缩
            var w = that.width,
                h = that.height,
                scale = w / h;
            w = obj.width || w;
            h = obj.height || (w / scale);
            //生成canvas
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            // 创建属性节点
            var anw = document.createAttribute("width");
            anw.nodeValue = w;
            var anh = document.createAttribute("height");
            anh.nodeValue = h;
            canvas.setAttributeNode(anw);
            canvas.setAttributeNode(anh);
            ctx.drawImage(that, 0, 0, w, h);
            // 图像质量
            //if (obj.quality && obj.quality <= 1 && obj.quality > 0) {
            //    quality = obj.quality;
            //}
            // quality值越小，所绘制出的图像越模糊
            var base64 = canvas.toDataURL('image/jpeg', quality);
            // 回调函数返回base64的值
            sp.innerText = base64
        }
    }

    var row = 0;
    function addworkHistory() {
        var projName = document.getElementById("projName").value;
        if (projName.length == 0) {
            swal('请填写承包项目');
            document.getElementById("projName").focus();
            return;
        }
        var contractAmount = document.getElementById("contractAmount").value;
        if (contractAmount.length == 0) {
            swal("请填写合同金额")
            document.getElementById("contractAmount").focus();
            return;
        }
        var timeBegin = document.getElementById("timeBegin").value;
        if (timeBegin.length == 0) {
            swal("请选择开工时间")
            document.getElementById("timeBegin").focus();
            return;
        }
        var timeEnd = document.getElementById("timeEnd").value;
        if (timeEnd.length == 0) {
            swal("请选择竣工时间")
            document.getElementById("timeEnd").focus();
            return;
        }
        var settleAmount = document.getElementById("settleAmount").value;
        if (settleAmount.length == 0) {
            swal("请选结算金额")
            document.getElementById("settleAmount").focus();
            return;
        }
        var fileInfoName = document.getElementById("fileInfoName").value;
        if (fileInfoName.length == 0) {
            swal("请上传合同扫描件")
            document.getElementById("fileInfoName").focus();
            return;
        }

        row = row + 1
        var rowtr = document.createElement("tr");
        rowtr.className = "white-bg"
        rowtr.id = "row" + row;
        var tdname = document.createElement("td");
        tdname.innerText = projName;

        var tdcAmount = document.createElement("td");
        tdcAmount.innerText = contractAmount + '万'

        var tdtimeBegin = document.createElement("td");
        tdtimeBegin.innerText = timeBegin

        var tdtimeEnd = document.createElement("td");
        tdtimeEnd.innerText = timeEnd

        var pstatus = document.createElement("td");
        pstatus.innerText = document.getElementById("iofnName").value;

        var samount = document.createElement("td");
        samount.innerText = settleAmount + '万'

        var tddelete = document.createElement("td");

        var tdffileName = document.createElement("td");
        var tdffileInfoName = $(".dw").html();
        tdffileName.innerText = tdffileInfoName;

        var tdhiddw = document.createElement("td");

        var tdfname = $("#fname").val();
        tdhiddw.innerText = tdfname;

        tddelete.innerHTML = '<div href="#" class="color01" style="cursor: pointer;" onclick=removeRow("row' + row + '")>删除</div>';
        rowtr.appendChild(tdname);
        rowtr.appendChild(tdcAmount);
        rowtr.appendChild(tdtimeBegin);
        rowtr.appendChild(tdtimeEnd);
        rowtr.appendChild(pstatus);
        rowtr.appendChild(pstatus);
        rowtr.appendChild(samount);
        rowtr.appendChild(tdffileName);
        rowtr.appendChild(tddelete);
        rowtr.appendChild(tdhiddw);

        document.getElementById("tworkhistory").appendChild(rowtr);
        $("#projName").val("");
        $("#contractAmount").val("");
        $("#timeEnd").val("");
        $("#timeBegin").val("");
        $("#settleAmount").val("");
        $(".dw").html("");
        if ($("#timeEnd").val() == "" || $("#timeEnd").val() == null) {
            $("#timeEnd").attr("placeholder", "竣工日期");
        }
        if ($("#timeBegin").val() == "" || $("#timeBegin").val() == null) {
            $("#timeBegin").attr("placeholder", "开工日期");
        }

    }
    function removeRow(rid) {
        console.log(rid);
        //var row = document.getElementById(rid)
        rid.parentNode.removeChild(rid);
    }
    function submitImg() {
        var success = 0;
        success += zzmc();
        success += zsbh();
        if (success > 0) {
            return;
        }
        if ($("#zzzsPic").html() != "") {
            $("#zspicmsg").html("上传成功！");

        } else {
            $("#zspicmsg").html("请上传资质文件");
            return;
        }
        var li = document.createElement('li');
        li.style = 'text-align:center'
        li.innerHTML = '<div><span class="aui-up-span"></span>' +
            '<img class="aui-close-up-img" src="../img/close.png"><img src="' + document.getElementById("zzzsPic").innerText + '" alt=""></div>' +
            '<label id="zzmc">' + $("#input_zzmc").val() + '</label><br><label id="zsbh">' + $("#input_zsbh").val() + '</label></li>'
        document.getElementById('zzlist').appendChild(li);
        $(".canvas").hide();
        $("#input_zsbh").val("");
        $("#input_zzmc").val("");
        $("#allfileInput3").val("");
        $("#zspicmsg").html("");

    }
    $(".canvas_close").on("click", function () {
        $("#zzzsPic").html("")
        $("#input_zzmc").val("");
        $("#zzmcmsg").html("");
        $("#input_zsbh").val("")
        $("#zsbhmsg").html("");
        $("#zspicmsg").html("");
        $(".canvas").hide();
    })
    $(".add-img").on("click", function () {
        $(".canvas").show();
        document.getElementById("input_zzmc").focus();
    })
    // 弹框上传资质扫描件
    $(".upload").on("change", "input[type='file']", function () {
        var filePath = $(this).val();
        var arr = filePath.split('\\');
        var fileName = arr[arr.length - 1];
        $(".canvas-fj").html(fileName);
    })
    $(".aui-close-up-img").click(function () {
        //$(this).parents("li").hide();
        console.log($(this).parents("li"))
    });
    function cancelImg() {
        $(".canvas").hide();
        $("#zzzsPic").html("")
        $("#input_zzmc").val("");
        $("#zzmcmsg").html("");
        $("#input_zsbh").val("")
        $("#zsbhmsg").html("");
        $("#zspicmsg").html("");
    }

    function zzmc() {

        var input_zzmc = $("#input_zzmc").val();
        if (input_zzmc = null || input_zzmc == "") {
            $("#input_zzmc").attr("placeholder", "资质名称");
            $("#zzmcmsg").html("×资质名称不能为空");
            return 1;
        } else {
            $("#zzmcmsg").html("");
            return 0;
        }

    }
    function zsbh() {
        var input_zsbh = $("#input_zsbh").val();
        if (input_zsbh = null || input_zsbh == "") {
            $("#input_zsbh").attr("placeholder", "(粤)JZ安许可证[2017]020932");
            $("#zsbhmsg").html("×证书编号不能为空");
            return 1;
        } else {
            $("#zsbhmsg").html("");
            return 0;
        }
    }

    </script>

