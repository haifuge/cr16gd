
@{
    ViewBag.Title = "名录外单位";
}
<link rel="stylesheet" href="~/css/icheck/minimal/minimal.css" />
<link href="~/css/sweetalert2.css" rel="stylesheet" />
<link rel="stylesheet" href="~/css/style.css" />
<style>
    #bType {
        float: left;
    }

    .wc-container {
        margin-top: 20px;
    }
</style>
<div class="left-nav">
    <div class="left-nav-con">
        <h1>劳务承分包企业</h1>
        <ul class="left-nav-list">
            <li><a href="/Companys"><i class="icon icon-eye"></i>名录内单位</a></li>
            <li><a href="CompanysOut" class="active"><i class="icon icon-hand"></i>名录外单位</a></li>
            <li><a href="MyAudit"><i class="icon icon-edit"></i>我审核的</a></li>
            <li><a href="/Companys/MyRecommend"><i class="icon icon-user"></i>我提交的</a></li>
        </ul>
    </div>
</div>

<div class="main-con">
    <div class="main-wrap">
        <div class="main-top">
            <a class="meet-btn blue-btn sm-btn" href="#" onclick="allcompany()">全部</a>
            <select class="meet-select js-meet-state" id="bType"></select>
            <div class="search-con2">
                <input type="text" name="keyname" placeholder="请输入关键字" id="searchinput">
                <a class="search-btn"><i class="search-icon meet-icon"></i></a>
            </div>
            <a href="#" class="meet-btn orange-btn small-size sm-btn js-output-excle">
                <i class="xs-meet-icon icon-daoout"></i>导出
            </a>
            <a class="meet-btn green-btn small-size sm-btn" href="Create?inout=0">
                <i class="xs-meet-icon icon-add"></i>添加
            </a>
            @Html.Raw(ViewBag.delebtn)
        </div>
        <div class="wc-container">
            <table class="meet-table text-left">
                <thead class="wc-header">
                    <tr>
                        <td class="check-color" style="width:30px;padding:0px 5px">
                            <span class="table-all-check">
                                <input type="checkbox"
                                       class="icheck"
                                       name="all-check"
                                       id="all-check" />
                            </span>
                        </td>
                        <td style="width:200px;padding:0px 5px">劳务承包企业名称</td>
                        <td style="width:240px;padding:0px 5px">资质等级</td>
                        <td style="width:100px;padding:0px 5px">注册资本</td>
                        <td style="width:100px;padding:0px 5px">业务类型</td>
                        <td style="width:80px;padding:0px 5px">法人代表</td>
                        <td style="width:80px;padding:0px 5px">现场负责人</td>
                        <td style="width:100px;padding:0px 5px">联系电话</td>
                        <!--<td style="width:180px;padding:0px 5px">联系地址</td>-->
                        <td style="width:100px;padding:0px 5px; display:none" id="cstatus">状态</td>
                    </tr>
                </thead>
                <tbody id="tbCompany"></tbody>
            </table>
            <div class="page">
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="~/js/jquery-1.11.0.js"></script>
<script type='text/javascript' src='~/js/jquery-ui.min.js'></script>
<script src="~/js/sweetalert2.all.js"></script>
<script type="text/javascript" src="~/js/validate/jquery.validate.min.js"></script>
<script type="text/javascript" src="~/js/validate/messages_zh.min.js"></script>
<script type="text/javascript" src="~/js/icheck/icheck.min.js"></script>
<script type='text/javascript' src='~/js/js.js'></script>
<script src="~/js/jquery.cookie.js"></script>

<script type='text/javascript'>
    //分页点击
    var cur_num = 1
    var clickpagenum = "" //所点击页码
    //当前所在页码
    var nowpage = 1;
    var page_size = 10
    var pagenum = 12
    Paginator(nowpage, page_size,"","")
    if ($.cookie("RoleId") == 2)
        $("#cstatus").show()

    //全部按钮
    function allcompany() {
        Paginator(nowpage, page_size, '', '')
        $("#searchinput").val("");
        $("#bType").val("All")
    }
    var SearchCompanyName = "";
    var type = "";
    //下拉菜单
    $("#bType").change(function () {
        if ($("#bType").val() == "All") {
            type = "";
        } else {
            type = $("#bType").val();
        }
        SearchCompanyName = $("#searchinput").val();
        Paginator(nowpage, page_size, SearchCompanyName, type)
        console.log(type);
        console.log(SearchCompanyName);
    })
    //输入框内容更改
    $("#searchinput").change(function () {
        if ($("#bType").val() == "All") {
            type = "";
        } else {
            type = $("#bType").val();
        }
        SearchCompanyName = $("#searchinput").val();
        Paginator(nowpage, page_size, SearchCompanyName, type)
        console.log(type);
        console.log(SearchCompanyName);
    })

    //点击搜索按钮
    $(".search-btn").on("click", function () {
        SearchCompanyName = $("#searchinput").val();
        if ($("#bType").val() == "All") {
            type = "";
        } else {
            type = $("#bType").val();
        }
        console.log(type);
        console.log(SearchCompanyName);
        Paginator(nowpage, page_size, SearchCompanyName, type)
    });


    function Paginator(page, ps, sname, stype) {
        sname = $("#searchinput").val();
        if ($("#bType").val() == "All") {
            stype = "";
        } else {
            stype = $("#bType").val();
        }
        $.post("/Companys/GetCompanies?ctype=0", { pageSize: ps, pageIndex: page,cname:sname,cctype:stype }, function (data) {
            var jsonData = JSON.parse(data);
            var obj = jsonData.List;
            var htm = "";
            for (var i = 0; i < obj.length; i++) {
                var o = obj[i]
                var chk = o.status == 1 ? "checked" : "";
                htm += "<tr class='white-bg'>" +
                    '<td class="check-color"><input class="icheck" name="id" type="checkbox" value="' + o.id + '" id="checkbox-1" /></td >' +
                    '<td onclick=\"location.href = \'/Companys/OutCompanyDetail?id=' + o.id + '\';\">' + o.name + '</td>' +
                    '<td onclick=\"location.href = \'/Companys/OutCompanyDetail?id=' + o.id + '\';\">' + o.qualificationlevel + '</td>' +
                    '<td onclick=\"location.href = \'/Companys/OutCompanyDetail?id=' + o.id + '\';\">' + o.registeredcapital + '万元</td>' +
                    '<td onclick=\"location.href = \'/Companys/OutCompanyDetail?id=' + o.id + '\';\">' + o.businesstype + '</td>' +
                    '<td onclick=\"location.href = \'/Companys/OutCompanyDetail?id=' + o.id + '\';\">' + o.corporaterepresentative + '</td>' +
                    '<td onclick=\"location.href = \'/Companys/OutCompanyDetail?id=' + o.id + '\';\">' + o.contact + '</td>' +
                    '<td onclick=\"location.href = \'/Companys/OutCompanyDetail?id=' + o.id + '\';\">' + o.contactphone + '</td>'
                if ($.cookie("RoleId") == 2)
                    htm += '<td class="gray-word"><div class="model-15"><div class="checkbox-switch label:after"><input type="checkbox" id="companyischecked" value="' + o.id + '" onclick="comischecked(' + o.id + ',this)" ' + chk + '><label></label></div></div></td>'
                // '<td onclick=\"location.href = \'/Companys/Details?id=' + o.id +'\';\" class="gray-word">' + o.contactaddress + '</td>' +
                '</tr > ';
            }
            var tbody = $("#tbCompany")
            //tbody.empty();
            tbody.html(htm)
            console.log(page, jsonData.PageCount, jsonData.total, ps)
            pages(page, jsonData.PageCount, jsonData.total, ps)
        });
    }
    function comischecked(comid, chk) {
        console.log(chk.checked);
        var s = 0;
        if (chk.checked)
            s = 1;
        else
            s = 0;
        $.post("/Companys/ToggleCompany?id=" + comid + "&status=" + s, {}, function () { });

    }


    $.get("/Common/GetCompanyType", function (data) {
        var obj = JSON.parse(data);
        var btype = $("#bType");
        btype.append("<option value='All'>业务类型</option>"); 
        for (var i = 0; i < obj.length; i++) {
            var o=obj[i]
            btype.append("<option value='"+o.id+"'>"+o.name+"</option>")
        }
    });


    //删除按钮
    function deleCompany() {
        if (!$("input.icheck").is(":checked")) {
            swal("请选择要删除的公司！")
            return;
        }
        swal({
            title: '确定删除？',
            text: '确定删除后，公司信息将无法恢复！',
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: '确定删除！'
        }).then(function (cc) {
            if (cc.dismiss != "cancel") {
                var checkID = "";
                $("input.icheck:checked").each(function (i) {//把所有被选中的复选框的值存入数组
                    checkID += $(this).val() + ',';
                })
                checkID = checkID.substr(0, checkID.length - 1)
                $.post("/Companys/DeleteCompany?ids=" + checkID, {}, function (res) {
                    if (res == "0") {
                        swal("删除成功！")
                    } else {
                        swal("删除失败！")
                    }

                    window.location.reload(true)
                });

            }
        })
    }
</script>